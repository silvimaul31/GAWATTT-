<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aide-Genie | Emergency Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --maroon: #800000; --soft-blue: #e0f2fe; --navy: #0f172a; }
        
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: linear-gradient(135deg, #f0f9ff 0%, #bae6fd 100%);
            color: var(--navy);
            min-height: 100vh;
        }

        .glass-nav { 
            background: rgba(255, 255, 255, 0.8); 
            backdrop-filter: blur(10px); 
            border-bottom: 2px solid var(--maroon);
        }

        .category-btn {
            background: white;
            border: 2px solid transparent;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        .category-btn:hover {
            transform: translateY(-3px);
            border-color: #cbd5e1;
        }
        .category-btn.selected {
            background: var(--maroon);
            color: white;
            transform: scale(0.95);
            box-shadow: 0 0 15px rgba(128, 0, 0, 0.3);
        }

        .elegant-input {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
        }
        .elegant-input:focus {
            border-color: var(--maroon);
            background: white;
            outline: none;
        }

        .sos-glow {
            background: var(--maroon);
            color: white;
            box-shadow: 0 10px 25px rgba(128, 0, 0, 0.4);
            animation: pulse-maroon 2s infinite;
        }
        @keyframes pulse-maroon {
            0% { box-shadow: 0 0 0 0 rgba(128, 0, 0, 0.5); }
            70% { box-shadow: 0 0 0 15px rgba(128, 0, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(128, 0, 0, 0); }
        }

        .full-overlay {
            position: fixed; inset: 0; background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(15px); z-index: 1000; display: none;
            align-items: center; justify-content: center; padding: 20px;
        }
        .white-modal {
            background: white; border-radius: 2.5rem; padding: 2.5rem;
            max-width: 380px; width: 100%; text-align: center;
        }
    </style>
</head>
<body>

    <div id="admin-pin-overlay" class="full-overlay">
        <div class="white-modal border-t-8 border-[#800000]">
            <h2 class="text-xl font-extrabold uppercase mb-4">Admin Access</h2>
            <input type="password" id="admin-pin-input" maxlength="4" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                   class="w-full p-4 text-center text-3xl font-bold bg-slate-100 rounded-2xl border-2 border-slate-200 focus:border-[#800000] outline-none" 
                   oninput="verifyAdminPin(this.value)">
            <button onclick="closeOverlay('admin-pin-overlay')" class="mt-6 text-xs font-bold text-slate-400 uppercase">Batal</button>
        </div>
    </div>

    <div id="success-overlay" class="full-overlay">
        <div class="white-modal">
            <div class="text-6xl mb-4">‚úÖ</div>
            <h2 class="text-2xl font-black text-[#800000] uppercase mb-2">SOS Terkirim!</h2>
            <p class="text-xs font-bold text-slate-500 mb-6 tracking-widest uppercase">Bantuan sedang diproses</p>
            <div class="text-left bg-slate-50 p-4 rounded-xl text-[11px] font-bold space-y-2 mb-6">
                <p>‚Ä¢ Mohon tunggu di lokasi aman</p>
                <p>‚Ä¢ Siapkan ponsel Anda</p>
                <p>‚Ä¢ Lokasi GPS Anda sudah kami terima</p>
            </div>
            <button onclick="location.reload()" class="w-full bg-[#0f172a] text-white py-4 rounded-xl font-bold uppercase text-[10px]">Mengerti</button>
        </div>
    </div>

    <nav class="glass-nav sticky top-0 z-50 p-4">
        <div class="max-w-xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2">
                <span class="text-2xl">üõ°Ô∏è</span>
                <h1 class="text-lg font-black tracking-tighter uppercase text-[#800000]">Aide-Genie</h1>
            </div>
            <div id="system-time" class="text-[10px] font-black opacity-40"></div>
        </div>
    </nav>

    <main class="max-w-xl mx-auto px-6 py-10 space-y-8">
        
        <div class="grid grid-cols-4 gap-3">
            <div onclick="selectCategory('Ambulans', this)" class="category-btn p-4 rounded-2xl flex flex-col items-center">
                <span class="text-2xl mb-1">üöë</span>
                <span class="text-[8px] font-black uppercase tracking-tighter">Ambulans</span>
            </div>
            <div onclick="selectCategory('Damkar', this)" class="category-btn p-4 rounded-2xl flex flex-col items-center">
                <span class="text-2xl mb-1">üöí</span>
                <span class="text-[8px] font-black uppercase tracking-tighter">Damkar</span>
            </div>
            <div onclick="selectCategory('Polisi', this)" class="category-btn p-4 rounded-2xl flex flex-col items-center">
                <span class="text-2xl mb-1">üëÆ</span>
                <span class="text-[8px] font-black uppercase tracking-tighter">Polisi</span>
            </div>
            <div onclick="selectCategory('SAR', this)" class="category-btn p-4 rounded-2xl flex flex-col items-center">
                <span class="text-2xl mb-1">üöÅ</span>
                <span class="text-[8px] font-black uppercase tracking-tighter">Tim SAR</span>
            </div>
        </div>

        <div class="bg-white p-8 rounded-[2.5rem] shadow-xl border-b-4 border-slate-200">
            <div class="text-center mb-6">
                <h2 class="text-xl font-black uppercase tracking-tight">Laporan Kejadian</h2>
                <p id="selected-label" class="text-[9px] font-black text-[#800000] uppercase tracking-widest mt-1">Pilih kategori di atas</p>
            </div>

            <div class="space-y-4">
                <input type="number" id="whatsapp" placeholder="No. WhatsApp..." class="elegant-input w-full p-4 rounded-xl text-sm font-bold">
                <textarea id="message" rows="2" placeholder="Apa yang terjadi?..." class="elegant-input w-full p-4 rounded-xl text-sm font-bold"></textarea>
                <textarea id="address" rows="2" placeholder="Patokan Lokasi..." class="elegant-input w-full p-4 rounded-xl text-sm font-bold"></textarea>

                <button onclick="sendSOS()" id="btnSend" class="sos-glow w-full py-5 rounded-2xl text-[11px] font-black uppercase tracking-[0.2em] mt-4">
                    Kirim Sinyal SOS ‚ö†Ô∏è
                </button>
            </div>
        </div>

        <p onclick="openOverlay('admin-pin-overlay')" class="text-center text-[9px] font-black opacity-20 hover:opacity-100 cursor-pointer uppercase tracking-widest transition-all">
            Access Command Center üîê
        </p>
    </main>

    <script>
        let selectedCat = "";
        const CORRECT_PIN = "1234";

        function openOverlay(id) { document.getElementById(id).style.display = 'flex'; }
        function closeOverlay(id) { document.getElementById(id).style.display = 'none'; }

        function verifyAdminPin(val) {
            if (val === CORRECT_PIN) window.location.href = "admin.html";
            else if (val.length === 4) { alert("PIN Salah!"); document.getElementById('admin-pin-input').value = ''; }
        }

        function selectCategory(cat, el) {
            selectedCat = cat;
            document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('selected'));
            el.classList.add('selected');
            document.getElementById('selected-label').innerText = "KATEGORI: " + cat;
        }

        setInterval(() => {
            const d = new Date();
            document.getElementById('system-time').innerText = d.getHours() + ":" + d.getMinutes().toString().padStart(2, '0');
        }, 1000);

        // Firebase Setup
        const firebaseConfig = { 
            apiKey: "PASTE_API_KEY_KAMU", 
            databaseURL: "https://project-gawattt-default-rtdb.asia-southeast1.firebasedatabase.app/", 
            projectId: "project-gawattt" 
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // FUNGSI UTAMA SOS DENGAN GPS
        function sendSOS() {
            const wa = document.getElementById('whatsapp').value;
            const msg = document.getElementById('message').value;
            const addr = document.getElementById('address').value;
            const btn = document.getElementById('btnSend');

            if(!selectedCat || !wa || !msg || !addr) { alert("Lengkapi data!"); return; }

            btn.innerText = "MENDETEKSI GPS...";
            btn.disabled = true;

            // Meminta Lokasi Otomatis
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const coords = position.coords.latitude + "," + position.coords.longitude;
                        saveData(wa, msg, addr, coords);
                    },
                    (error) => {
                        console.warn("GPS ditolak/gagal, mengirim tanpa koordinat.");
                        saveData(wa, msg, addr, "0,0");
                    },
                    { enableHighAccuracy: true, timeout: 5000 }
                );
            } else {
                saveData(wa, msg, addr, "0,0");
            }
        }

        function saveData(wa, msg, addr, locationCoords) {
            database.ref('adminReports/' + Date.now()).set({
                category: selectedCat, 
                whatsapp: wa, 
                message: msg, 
                address: addr,
                time: new Date().toLocaleString(), 
                status: "MENUNGGU", 
                location: locationCoords
            }).then(() => {
                openOverlay('success-overlay');
            });
        }
    </script>
</body>
</html>
