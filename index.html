<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aide-Genie | Asisten Darurat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@600;700;800&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: #f8fafc;
            background-image: radial-gradient(at 0% 0%, rgba(0, 0, 128, 0.05) 0px, transparent 50%), radial-gradient(at 100% 0%, rgba(128, 0, 0, 0.05) 0px, transparent 50%);
            background-attachment: fixed;
            transition: background 0.8s ease;
        }
        .bg-navy { background-color: #000080; }
        .bg-maroon { background-color: #800000; }
        .chat-bubble { animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        @keyframes pop { from { opacity: 0; transform: scale(0.9) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        .sos-shake { animation: shake 0.3s infinite; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-3px); } 75% { transform: translateX(3px); } }
        .glass-header { background: rgba(128, 0, 0, 0.95); backdrop-filter: blur(10px); }
        .emergency-active { background: #450a0a !important; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header id="main-header" class="glass-header p-5 text-white flex justify-between items-center sticky top-0 z-[110] shadow-lg rounded-b-[30px]">
        <div class="flex items-center gap-3">
            <div class="bg-white/20 p-2 rounded-xl text-xl">‚ù§Ô∏è</div>
            <div>
                <h1 class="text-lg font-extrabold tracking-tight">Aide-Genie</h1>
                <p class="text-[9px] font-bold opacity-70 uppercase tracking-widest">Emergency System</p>
            </div>
        </div>
        <a href="admin.html" class="bg-white/10 px-4 py-2 rounded-xl text-[10px] font-black border border-white/10 uppercase">Admin ‚öôÔ∏è</a>
    </header>

    <div class="p-4 grid grid-cols-4 gap-3 max-w-2xl mx-auto w-full mt-2 relative z-[100]">
        <div onclick="panggilBantuan('Ambulans')" class="bg-white p-3 rounded-2xl shadow-sm text-center border border-slate-100 active:scale-95 transition-all cursor-pointer">
            <div class="text-xl mb-1">üöë</div>
            <p class="text-[8px] font-black uppercase text-slate-500">Ambulans</p>
        </div>
        <div onclick="panggilBantuan('Damkar')" class="bg-white p-3 rounded-2xl shadow-sm text-center border border-slate-100 active:scale-95 transition-all cursor-pointer">
            <div class="text-xl mb-1">üöí</div>
            <p class="text-[8px] font-black uppercase text-slate-500">Damkar</p>
        </div>
        <div onclick="panggilBantuan('Polisi')" class="bg-white p-3 rounded-2xl shadow-sm text-center border border-slate-100 active:scale-95 transition-all cursor-pointer">
            <div class="text-xl mb-1">üëÆ</div>
            <p class="text-[8px] font-black uppercase text-slate-500">Polisi</p>
        </div>
        <div onclick="panggilBantuan('Tim SAR')" class="bg-white p-3 rounded-2xl shadow-sm text-center border border-slate-100 active:scale-95 transition-all cursor-pointer">
            <div class="text-xl mb-1">üöÅ</div>
            <p class="text-[8px] font-black uppercase text-slate-500">Tim SAR</p>
        </div>
    </div>

    <main id="chat-box" class="flex-1 p-6 max-w-2xl mx-auto w-full space-y-4 overflow-y-auto relative z-10"></main>

    <footer class="p-6 bg-white/80 backdrop-blur-lg border-t border-slate-100 rounded-t-[40px] shadow-2xl sticky bottom-0 z-[110]">
        <div class="max-w-2xl mx-auto space-y-4">
            <div id="sos-status" class="hidden">
                <div class="bg-navy text-white p-3 rounded-2xl text-center text-[10px] font-black uppercase tracking-[0.2em] animate-pulse">
                    üöÄ SOS AKTIF! PETUGAS SEDANG MENUJU LOKASI
                </div>
            </div>
            <div class="flex gap-2">
                <input type="text" id="user-msg" placeholder="Tulis kondisi darurat..." class="flex-1 p-4 bg-slate-100 rounded-[20px] focus:outline-none text-sm font-bold border-none transition-all">
                <button onclick="sendMsg()" class="bg-navy text-white p-4 rounded-[20px] shadow-lg active:scale-95 transition-all">üöÄ</button>
            </div>
            <button onclick="sendSOS()" class="sos-shake w-full bg-maroon text-white py-5 rounded-[25px] font-black text-xs uppercase tracking-[0.2em] shadow-xl border-b-4 border-red-900 active:scale-95 transition-all">
                ‚ö†Ô∏è SOS ADMIN!!!! ‚ö†Ô∏è
            </button>
        </div>
    </footer>

    <script>
        // --- CONFIGURATION ---
        const MY_PHONE_NUMBER = "6285924179517"; // GANTI DENGAN NOMOR WA KAMU (Gunakan kode 62)
        const firebaseConfig = {
            apiKey: "PASTE_API_KEY_KAMU",
            databaseURL: "https://project-gawattt-default-rtdb.asia-southeast1.firebasedatabase.app/",
            projectId: "project-gawattt",
        };
        
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        function playTone(freq, type, duration) {
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        // --- GPS & FIREBASE LOGIC ---
        function pushToFirebase(pesan, status = "DARURAT") {
            // Kita coba ambil koordinat asli dulu
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    
                    database.ref('adminReports').push({
                        message: pesan,
                        time: new Date().toLocaleString(),
                        status: status,
                        whatsapp: MY_PHONE_NUMBER,
                        coords: `${lat.toFixed(4)}, ${lon.toFixed(4)}`,
                        location: `https://www.google.com/maps?q=${lat},${lon}`
                    });
                }, (error) => {
                    // Jika GPS dimatikan user, kirim lokasi default
                    database.ref('adminReports').push({
                        message: pesan + " (GPS Off)",
                        time: new Date().toLocaleString(),
                        status: status,
                        whatsapp: MY_PHONE_NUMBER,
                        coords: "Lokasi Tidak Diizinkan",
                        location: "#"
                    });
                });
            }
        }

        function panggilBantuan(jenis) {
            playTone(500, 'sine', 0.2);
            const msg = `BUTUH BANTUAN ${jenis.toUpperCase()}!! üö®`;
            document.getElementById('chat-box').innerHTML += `<div class="chat-bubble flex justify-end"><div class="bg-navy text-white p-4 rounded-2xl rounded-tr-none shadow-md max-w-[80%] text-sm font-bold">${msg}</div></div>`;
            pushToFirebase(msg, "URGENT");
            
            setTimeout(() => {
                document.getElementById('chat-box').innerHTML += `<div class="chat-bubble flex gap-3 items-start"><div class="w-8 h-8 bg-slate-200 rounded-full flex items-center justify-center text-sm">ü§ñ</div><div class="bg-white p-4 rounded-2xl rounded-tl-none shadow-sm border text-sm font-bold text-slate-700">Laporan ${jenis} sudah masuk ke sistem pusat!</div></div>`;
                const cb = document.getElementById('chat-box'); cb.scrollTop = cb.scrollHeight;
            }, 800);
        }

        function sendMsg() {
            const input = document.getElementById('user-msg');
            if(!input.value) return;
            document.getElementById('chat-box').innerHTML += `<div class="chat-bubble flex justify-end"><div class="bg-navy text-white p-4 rounded-2xl rounded-tr-none shadow-md max-w-[80%] text-sm font-bold">${input.value}</div></div>`;
            pushToFirebase(input.value, "PESAN");
            input.value = "";
            const cb = document.getElementById('chat-box'); cb.scrollTop = cb.scrollHeight;
        }

        function sendSOS() {
            playTone(900, 'sawtooth', 0.5);
            document.body.classList.add('emergency-active');
            document.getElementById('sos-status').classList.remove('hidden');
            
            const msg = "üö® DARURAT SOS ! TOLONG SEGERA!";
            pushToFirebase(msg, "GAWAT");
            
            document.getElementById('chat-box').innerHTML += `<div class="chat-bubble flex gap-3 items-start"><div class="w-8 h-8 bg-red-600 text-white rounded-full flex items-center justify-center text-[10px] font-black animate-bounce">üö®</div><div class="bg-red-600 text-white p-4 rounded-2xl rounded-tl-none shadow-xl text-sm font-bold">POSISI ANDA TERKUNCI! Admin sedang memproses bantuan.</div></div>`;
            const cb = document.getElementById('chat-box'); cb.scrollTop = cb.scrollHeight;
            alert("SOS Terkirim! Pastikan Izin Lokasi (GPS) Aktif.");
        }
    </script>
</body>
</html>

